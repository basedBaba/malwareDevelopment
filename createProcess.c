#include <windows.h>
#include <stdio.h>

int main(void) {

    STARTUPINFO si = {};
    PROCESS_INFORMATION pi = {};

    if (!CreateProcess(
            "C:\\Windows\\System32\\notepad.exe",
            NULL,
            NULL,
            NULL,
            FALSE,
            NORMAL_PRIORITY_CLASS,
            NULL,
            NULL,
            &si,
            &pi
    )) {

        printf("(-) Failed to create process! Error: %d", GetLastError());

        return EXIT_FAILURE;
    }

    HANDLE hProcess = pi.hProcess;
    HANDLE hThread = pi.hThread;
    DWORD PID = pi.dwProcessId;
    DWORD TID = pi.dwThreadId; 

    printf("(+) Got handle to process\n");
    printf("(+) Process created! PID: %d\n", PID);
    printf("\t(+) PID: %d, Handle: 0x%x\n", PID, hProcess);
    printf("\t(+) TID: %d, Handle: 0x%x\n", TID, hThread);


    WaitForSingleObject(
        hProcess,
        INFINITE
    );

    printf("(+) Finished! Exiting...");

    CloseHandle(
        hProcess
    );

    CloseHandle(
        hThread
    );

    return EXIT_SUCCESS;
}