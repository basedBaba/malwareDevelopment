#include <windows.h>
#include <stdio.h>

#define okay(msg, ...) printf("[+] " msg "\n", ##__VA_ARGS__)
#define warn(msg, ...) printf("[-] " msg "\n", ##__VA_ARGS__)
#define info(msg, ...) printf("[i] " msg "\n", ##__VA_ARGS__)

int main(int argc, char* argv[]) {

    DWORD dwPID = NULL;
    HANDLE hProcess = NULL;

    if (argc < 2) {

        warn("Usage: %s <PID>", argv[0]);

        return EXIT_FAILURE;
    }

    dwPID = atoi(argv[1]);

    info("Trying to get a handle to the process (%ld)", dwPID);

    hProcess = OpenProcess(
        PROCESS_VM_OPERATION | PROCESS_VM_WRITE,
        FALSE,
        dwPID
    );

    if (hProcess == NULL) {

        warn("Failed to get a handle to the process (%ld), Error: 0x%lx", dwPID, GetLastError());

        return EXIT_FAILURE;
    }

    okay("Got a handle to the process (%ld)!", dwPID);
    info("\\___[ hProcess\n\t\\_0x%p]", hProcess);

CLEANUP:

    if (hProcess) {
        
        info("Closing handle to the process");

        CloseHandle(
            hProcess
        );

    }

    okay("Finished!");

    return EXIT_SUCCESS;
}